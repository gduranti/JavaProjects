<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:cc="http://java.sun.com/jsf/composite/components">

<ui:composition template="templates/layout.xhtml">
	<ui:define name="content">
	
		<f:view>
			<f:event listener="#{myMediaListController.init()}" type="preRenderView" />
			
			<p:panel header="#{myMediaListController.viewTitle}" >
				<h:form id="form" prependId="false">

				    <p:growl id="messages" globalOnly="true" />
					
				    <p:toolbar styleClass="unitunes-toolbar" >
				        <f:facet name="left">
				        
					        <p:selectOneButton value="#{myMediaListController.model.myMediaFilter}" >
								<p:ajax event="change" process="@this" update="@form" />
								<f:selectItems value="#{listsController.myMediaFilterTypes}" var="t" itemLabel="#{t.description}" />
					        </p:selectOneButton>
							
							<span class="ui-separator">
				                <span class="ui-icon ui-icon-grip-dotted-vertical" />
				            </span>
				        	
					        <p:selectOneButton value="#{myMediaListController.model.typeFilter}" >
								<p:ajax event="change" listener="#{myMediaListController.clearList()}" process="@this" update="@form" />
								<f:selectItems value="#{listsController.mediaTypes}" var="t" itemLabel="#{t.description}" />
					        </p:selectOneButton>
							
							<span class="ui-separator">
				                <span class="ui-icon ui-icon-grip-dotted-vertical" />
				            </span>
							
							<p:selectOneMenu value="#{myMediaListController.model.categoryFilter}" >
								<p:ajax event="change" listener="#{myMediaListController.clearList()}" process="@this" update="@form" />
								<f:selectItem itemLabel="Todas Categorias" itemValue=" " />
								<f:selectItems value="#{listsController.getMediaCategories(myMediaListController.model.typeFilter)}"
											var="c" itemLabel="#{c.name}" />
							</p:selectOneMenu>
				        </f:facet>
			        </p:toolbar>
					
					<pe:fluidGrid hasImages="true" hGutter="5" vGutter="5" >
						
						<c:forEach items="#{myMediaListController.list()}" var="m" >
							<pe:fluidGridItem styleClass="media-box" >
								<p:panel>
									
									<f:facet name="header">
										<p:link value="#{m.name}" href="media-form.xhtml?id=#{m.id}" />
									</f:facet>
									
									<p:graphicImage value="#{myMediaListController.getThumb()}" cache="false">
										<f:param name="media-id" value="#{m.id}" />
									</p:graphicImage>
									
									<f:facet name="footer">
										
										<p:commandButton icon="ui-icon-star" action="#{myMediaListController.addFavoriteMedia(m)}" update="@form"
														title="Adicionar mídia como favorita"
														rendered="#{not sessionController.isUserFavoriteMedia(m)}" />
										
										<p:commandButton icon="ui-icon-cancel" action="#{myMediaListController.removeFavoriteMedia(m)}" update="@form"
														title="Remover mídia dos favoritos"
														rendered="#{sessionController.isUserFavoriteMedia(m)}" />
										
										<p:commandButton value="#{myMediaListController.formatMediaValue(m)}" icon="ui-icon-cart" 
														action="#{myMediaListController.purchaseMedia(m)}" update="@form"
														rendered="#{not sessionController.isUserPurchasedMedia(m) and sessionController.loged}" >
									        <p:confirm message="Deseja comprar a mídia #{m.name} por R$ #{myMediaListController.formatMediaValue(m)}?"
									        			 header="Atenção" icon="ui-icon-cart" />
										</p:commandButton>
										
										<p:commandButton value="Executar" icon="ui-icon-arrowthickstop-1-s"
														rendered="#{sessionController.isUserPurchasedMedia(m)}" ajax="false" >
											<p:fileDownload value="#{myMediaListController.executeMedia(m)}" />
										</p:commandButton>
									</f:facet>
									
								</p:panel>
							</pe:fluidGridItem>
						</c:forEach>
						
					</pe:fluidGrid>
					
				</h:form>
			</p:panel>
		</f:view>

	</ui:define>
</ui:composition>

</html>